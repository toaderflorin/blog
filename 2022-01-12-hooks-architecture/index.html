<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><style data-href="/styles.36ef0a7f785eba6d23fa.css" data-identity="gatsby-global-css">@font-face{font-family:gilroy;font-weight:400;src:url(/fonts/Gilroy-Regular.ttf)}@font-face{font-family:instrument;src:url(/fonts/Instrument.ttf)}@font-face{font-family:matter;src:url(/fonts/Matter-Regular.ttf)}@font-face{font-family:cisco;src:url(/font/CiscoSans.ttf)}@font-face{font-family:proxima;src:url(/fonts/TTHoves-Regular.ttf)}@font-face{font-family:suisse;src:url(/fonts/SuisseIntl-Light.otf)}@font-face{font-family:aktiv;src:url(/fonts/AktivGrotesk-Light.ttf)}@font-face{font-family:helv;src:url(/fonts/HelveticaNowDisplay-Regular.otf)}@font-face{font-family:balto;src:url(/fonts/Balto-Book.ttf)}@font-face{font-family:balto;font-weight:700;src:url(/fonts/Balto-Bold.woff2)}@font-face{font-family:neue;src:url(/fonts/Balto-Bold.woff2)}:root{--color-primary:#ff164c}*,:after,:before{box-sizing:border-box;margin:0}h1,h2,h3,html{margin:0}html{padding:0}pre.shiki{background-color:#fcfcfc!important;border:1px solid #eaeaea;border-radius:5px;margin-left:-17px;margin-right:-17px;padding:17px}code,pre.shiki{font-size:13px}body{color:#333;font-family:balto,serif;font-size:15px;line-height:1.55}h1{font-size:1.8rem}h3{font-size:1.1rem;line-height:2;margin-bottom:-1rem}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{margin:.7rem 0}a{color:var(--color-primary);text-decoration:none}.img{width:100%}.img-side{float:left;width:300px}ul{margin:.7rem 0}.article-icon{float:left;height:64px;margin-right:8px;margin-top:6px;width:64px}.fixed{position:fixed}.relative{position:relative}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mt-3{margin-top:.75rem}.mt-\[40px\]{margin-top:40px}.flex{display:flex}.h-\[100\%\]{height:100%}.h-\[3px\]{height:3px}.h-\[600px\]{height:600px}.h-\[64px\]{height:64px}.w-\[100\%\]{width:100%}.w-\[1000px\]{width:1000px}.w-\[650px\]{width:650px}.w-\[700px\]{width:700px}.cursor-pointer{cursor:pointer}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.rounded-sm{border-radius:.125rem}.bg-\[color\:var\(--color-primary\)\]{background-color:var(--color-primary)}.bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-\[url\(\/img\/an_bk\.jpg\)\]{background-image:url(/img/an_bk.jpg)}.bg-cover{background-size:cover}.bg-fixed{background-attachment:fixed}.p-6{padding:1.5rem}.pt-12{padding-top:3rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-\[color\:var\(--color-primary\)\]{color:var(--color-primary)}.text-slate-100{--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgba(0,0,0,.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color)}.shadow-2xl,.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.blur-md{--tw-blur:blur(12px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\:shadow-\[0_0_40px_-15px_rgba\(0\2c 0\2c 0\2c 0\.2\)\]:hover{--tw-shadow:0 0 40px -15px rgba(0,0,0,.2);--tw-shadow-colored:0 0 40px -15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="true"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400&amp;display=swap"/><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=4376dbdae9096a24eda7625764953946" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4376dbdae9096a24eda7625764953946"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header class="global-header"></header><main><div class="fixed top-0 left-0 right-0 text-white bg-slate-800 h-[64px] shadow-lg"><div class="w-[700px] mx-auto flex items-center h-[64px]">florin<b>toader</b></div></div><article class="w-[700px] mx-auto pt-[150px]" itemscope="" style="margin-top:100px;margin-bottom:20px"><header><h1 itemProp="headline">What If We Wanted To Use Hooks Instead Of Redux?</h1><p><i>January 11, 2022</i></p></header><section itemProp="articleBody"><p>While the rumors about Redux’s demise are most likely mostly exaggerated, there is no doubt we can achieve a lot of the functionality it provides with hooks. Also, as a rule of thumb, we should avoid using as many external libraries as possible because chances are they could become deprecated in the future. While using the <span class="code">useReducer</span> hook is relatively straightforward, React doesn’t provide a prescription on how to structure a relatively large application. To make matters worse, virtually every blog article on the internet recommends using a different approach.</p>
<p>Let’s first take a look at the Redux data flow.</p>
<img src="arch.png" class="img" />
<p>First of all, it’s worth pointing out that the data flow is unidirectional. The user can trigger actions from the UI, which act on the application state via a <em>reducer</em>, which in turn triggers rerendering of the UI. The is aim to replicate this flow using the built in React functionality.</p>
<p>With hooks, React provides powerful features when writing functional components, and it’s not opinionated on how you use them. The problem is, choosing the right approach can be tricky because there are so many permutations. Developers moving from .NET WebAPI or Rails (which are very opinionated in how you name your controllers and routes) to NodeJS / Express (which imposes no restrictions on how to structure your code) will find this approach very familiar.</p>
<p>Another relatively new addition to React is the Context API. If you’re not familiar with what it is, it’s a way for components to avoid having to pass down props through complex component trees — a technique known as <em>prop drilling</em>. React’s rendering engine knows to react to changes in the context state, just as it is able to respond to changes in component state or prop changes.</p>
<ol>
<li>We could have different contexts per route with separate data stores for each of them.</li>
<li>We could use a single context per application, and each route can keep its state in a property of the single app state object.</li>
</ol>
<p>We’ll go with option number two because that’s what Redux does, and most developers are familiar with that approach. The aim is to create a personal organizer application that has two sections: notes and tasks. The note page and task page structure are similar, so we’ll present the code for notes as an example.</p>
<img src="pic2.png" class="img" />
<p>Since we plan to lay the groundwork for a complex app, we’ll assume that this application has multiple <em>modules</em>. Each module will have a <em>components</em> folder, which contains the UI code, and a <em>store</em> folder which contains the action creators and the reducer logic.</p>
<p>The reducer created with the <code>useReducer</code> hook works similar to a Redux reducer. It’s just a function that takes a <em>state</em> object and an <em>action</em> object, and based on that, it returns a new state object. One way of thinking about it is it’s a way of mutating state, but of course we’re not really mutate the existing state, but rather creating a new state object (immutability is one of the central tenets of functional programming).</p>
<p>We’ll need to create reducer actions for:</p>
<ol>
<li>Creating a new note.</li>
<li>Removing an existing note.</li>
<li>Updating an existing note.</li>
</ol>
<pre class="shiki" style="background-color: #ffffff"><code><span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { NotesState, NotesAction, Note } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;./types&#39;</span></span>
<span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { ADD_NOTE, REMOVE_NOTE, UPDATE_NOTE } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;./actions&#39;</span></span>
<span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { v4 } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;uuid&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">initialNotesState</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">NotesState</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">  notes: []</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">notesReducer</span><span style="color: #24292F">(</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">NotesState</span><span style="color: #24292F">, </span><span style="color: #953800">action</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">NotesAction</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">switch</span><span style="color: #24292F"> (action.type) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">case</span><span style="color: #24292F"> </span><span style="color: #0550AE">ADD_NOTE</span><span style="color: #24292F">: {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">note</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">        id: </span><span style="color: #8250DF">v4</span><span style="color: #24292F">(),</span></span>
<span class="line"><span style="color: #24292F">        title: action.title,</span></span>
<span class="line"><span style="color: #24292F">        description: action.description</span></span>
<span class="line"><span style="color: #24292F">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">        </span><span style="color: #CF222E">...</span><span style="color: #24292F">state,</span></span>
<span class="line"><span style="color: #24292F">        notes: [</span><span style="color: #CF222E">...</span><span style="color: #24292F">state.notes, note]</span></span>
<span class="line"><span style="color: #24292F">      }</span></span>
<span class="line"><span style="color: #24292F">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">case</span><span style="color: #24292F"> </span><span style="color: #0550AE">REMOVE_NOTE</span><span style="color: #24292F">: {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">        </span><span style="color: #CF222E">...</span><span style="color: #24292F">state,</span></span>
<span class="line"><span style="color: #24292F">        notes: state.notes.</span><span style="color: #8250DF">filter</span><span style="color: #24292F">((</span><span style="color: #953800">note</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Note</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> note.id </span><span style="color: #CF222E">!==</span><span style="color: #24292F"> action.noteId)</span></span>
<span class="line"><span style="color: #24292F">      }</span></span>
<span class="line"><span style="color: #24292F">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">case</span><span style="color: #24292F"> </span><span style="color: #0550AE">UPDATE_NOTE</span><span style="color: #24292F">: {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">        </span><span style="color: #CF222E">...</span><span style="color: #24292F">state,</span></span>
<span class="line"><span style="color: #24292F">        notes: state.notes.</span><span style="color: #8250DF">map</span><span style="color: #24292F">((</span><span style="color: #953800">note</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Note</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">          </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (note.id </span><span style="color: #CF222E">===</span><span style="color: #24292F"> action.noteId) {</span></span>
<span class="line"><span style="color: #24292F">            </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">              </span><span style="color: #CF222E">...</span><span style="color: #24292F">note,</span></span>
<span class="line"><span style="color: #24292F">              title: action.title,</span></span>
<span class="line"><span style="color: #24292F">              description: action.description</span></span>
<span class="line"><span style="color: #24292F">            }</span></span>
<span class="line"><span style="color: #24292F">          } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">            </span><span style="color: #CF222E">return</span><span style="color: #24292F"> note</span></span>
<span class="line"><span style="color: #24292F">          }</span></span>
<span class="line"><span style="color: #24292F">        })</span></span>
<span class="line"><span style="color: #24292F">      }</span></span>
<span class="line"><span style="color: #24292F">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">default</span><span style="color: #24292F">: {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> state</span></span>
<span class="line"><span style="color: #24292F">    }</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"><span style="color: #24292F">}</span></span></code></pre>
<p>Now that we have defined a reducer, we’ll want to create the equivalent of Redux’s action creators.</p>
<pre class="shiki" style="background-color: #ffffff"><code><span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { Dispatch } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;react&#39;</span></span>
<span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { NotesAction } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;./types&#39;</span></span>
<span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { AppState } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;../../types&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ADD_NOTE</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;ADD_NOTE&#39;</span></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">REMOVE_NOTE</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;REMOVE_NOTE&#39;</span></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">UPDATE_NOTE</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;UPDATE_NOTE&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">addNote</span><span style="color: #24292F">(</span><span style="color: #953800">title</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">, </span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> (</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">AppState</span><span style="color: #24292F">, </span><span style="color: #953800">dispatch</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Dispatch</span><span style="color: #24292F">&lt;</span><span style="color: #953800">NotesAction</span><span style="color: #24292F">&gt;;) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #8250DF">dispatch</span><span style="color: #24292F">({</span></span>
<span class="line"><span style="color: #24292F">      type: </span><span style="color: #0550AE">ADD_NOTE</span><span style="color: #24292F">,</span></span>
<span class="line"><span style="color: #24292F">      title,</span></span>
<span class="line"><span style="color: #24292F">      description</span></span>
<span class="line"><span style="color: #24292F">    })</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">removeNote</span><span style="color: #24292F">(</span><span style="color: #953800">noteId</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> (</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">AppState</span><span style="color: #24292F">, </span><span style="color: #953800">dispatch</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Dispatch</span><span style="color: #24292F">&lt;</span><span style="color: #953800">NotesAction</span><span style="color: #24292F">&gt;;) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #8250DF">dispatch</span><span style="color: #24292F">({</span></span>
<span class="line"><span style="color: #24292F">      type: </span><span style="color: #0550AE">REMOVE_NOTE</span><span style="color: #24292F">,</span></span>
<span class="line"><span style="color: #24292F">      noteId</span></span>
<span class="line"><span style="color: #24292F">    })</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">updateNote</span><span style="color: #24292F">(</span><span style="color: #953800">noteId</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">, </span><span style="color: #953800">title</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">, </span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> (</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">AppState</span><span style="color: #24292F">, </span><span style="color: #953800">dispatch</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Dispatch</span><span style="color: #24292F">&lt;</span><span style="color: #953800">NotesAction</span><span style="color: #24292F">&gt;;) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #8250DF">dispatch</span><span style="color: #24292F">({</span></span>
<span class="line"><span style="color: #24292F">      type: </span><span style="color: #0550AE">UPDATE_NOTE</span><span style="color: #24292F">,</span></span>
<span class="line"><span style="color: #24292F">      noteId,</span></span>
<span class="line"><span style="color: #24292F">      title,</span></span>
<span class="line"><span style="color: #24292F">      description</span></span>
<span class="line"><span style="color: #24292F">    })</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"><span style="color: #24292F">}</span></span></code></pre>
<p>And finally, let’s have a look the <em>types.ts</em> file.</p>
<pre class="shiki" style="background-color: #ffffff"><code><span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { ADD_NOTE, REMOVE_NOTE, UPDATE_NOTE } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;./actions&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">Note</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">id</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">title</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">NotesState</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">notes</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Note</span><span style="color: #24292F">[]</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">NotesAction</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">|</span><span style="color: #24292F"> { </span><span style="color: #953800">type</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #CF222E">typeof</span><span style="color: #24292F"> </span><span style="color: #0550AE">ADD_NOTE</span><span style="color: #24292F">, </span><span style="color: #953800">title</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">, </span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F"> }</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">|</span><span style="color: #24292F"> { </span><span style="color: #953800">type</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #CF222E">typeof</span><span style="color: #24292F"> </span><span style="color: #0550AE">REMOVE_NOTE</span><span style="color: #24292F">, </span><span style="color: #953800">noteId</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F"> }</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">|</span><span style="color: #24292F"> { </span><span style="color: #953800">type</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #CF222E">typeof</span><span style="color: #24292F"> </span><span style="color: #0550AE">UPDATE_NOTE</span><span style="color: #24292F">, </span><span style="color: #953800">noteId</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">, </span><span style="color: #953800">title</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">, </span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F"> }</span></span></code></pre>
<p>Our application also has a <em>tasks</em> section which has the same structure — actions, and a state reducer. Since the application uses a single data store, we need to combine both our reducers into a single one. We’ll create an <em>appReducer.ts</em> file for this.</p>
<pre class="shiki" style="background-color: #ffffff"><code><span class="line"><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">Action</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">|</span><span style="color: #24292F"> </span><span style="color: #953800">NotesAction</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">|</span><span style="color: #24292F"> </span><span style="color: #953800">TasksAction</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">initialAppState</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">  tasks: initialTasksState,</span></span>
<span class="line"><span style="color: #24292F">  notes: initialNotesState</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">combinedReducer</span><span style="color: #24292F">(</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">AppState</span><span style="color: #24292F">, </span><span style="color: #953800">action</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Action</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">    notes: </span><span style="color: #8250DF">notesReducer</span><span style="color: #24292F">(state.notes, action </span><span style="color: #CF222E">as</span><span style="color: #24292F"> </span><span style="color: #953800">NotesAction</span><span style="color: #24292F">),</span></span>
<span class="line"><span style="color: #24292F">    tasks: </span><span style="color: #8250DF">tasksReducer</span><span style="color: #24292F">(state.tasks, action </span><span style="color: #CF222E">as</span><span style="color: #24292F"> </span><span style="color: #953800">TasksAction</span><span style="color: #24292F">)</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"><span style="color: #24292F">}</span></span></code></pre>
<p>Let’s try to put it all together now. We need a way for the UI to be able to call our actions and to react to changes in the application state. We’ll use a global context that can be accessed from anywhere in the application via the useContext hook that will give the calling component access to the following:</p>
<ol>
<li>The global state of the app.</li>
<li>An execute method, which will allow it to trigger actions.</li>
</ol>
<pre class="shiki" style="background-color: #ffffff"><code><span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> React, { useReducer, Dispatch } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;react&#39;</span></span>
<span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { AppState, ChildrenProps } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;./modules/types&#39;</span></span>
<span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> appReducer, { initialAppState, Action } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;./appReducer&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">ExecuteFunc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> (</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">AppState</span><span style="color: #24292F">, </span><span style="color: #953800">dispatch</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Dispatch</span><span style="color: #24292F">&lt;</span><span style="color: #0550AE">any</span><span style="color: #24292F">&gt;) </span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #953800">Promise</span><span style="color: #24292F">&lt;</span><span style="color: #0550AE">void</span><span style="color: #24292F">&gt; </span><span style="color: #CF222E">|</span><span style="color: #24292F"> </span><span style="color: #0550AE">void</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">AppContextType</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">AppState</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #8250DF">execute</span><span style="color: #CF222E">:</span><span style="color: #24292F"> (</span><span style="color: #953800">action</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">ExecuteFunc</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #953800">Promise</span><span style="color: #24292F">&lt;</span><span style="color: #0550AE">void</span><span style="color: #24292F">&gt;</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6E7781">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">AppContext</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> React.</span><span style="color: #8250DF">createContext</span><span style="color: #24292F">({} </span><span style="color: #CF222E">as</span><span style="color: #24292F"> </span><span style="color: #0550AE">any</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> </span><span style="color: #953800">AppContextType</span><span style="color: #24292F">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #953800"> </span><span style="color: #CF222E">default</span><span style="color: #953800"> </span><span style="color: #CF222E">function</span><span style="color: #953800"> </span><span style="color: #8250DF">AppContextProvider</span><span style="color: #953800">(props</span><span style="color: #CF222E">:</span><span style="color: #953800"> ChildrenProps) </span><span style="color: #24292F">{</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">state</span><span style="color: #24292F">, </span><span style="color: #0550AE">dispatch</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">useReducer</span><span style="color: #24292F">(combinedReducer, initialAppState)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">async</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">execute</span><span style="color: #24292F">(</span><span style="color: #8250DF">action</span><span style="color: #CF222E">:</span><span style="color: #24292F"> (</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">AppState</span><span style="color: #24292F">, </span><span style="color: #953800">dispatch</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Dispatch</span><span style="color: #24292F">&lt;</span><span style="color: #953800">Action</span><span style="color: #24292F">&gt;) </span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F">; </span><span style="color: #953800">Promise</span><span style="color: #24292F">&lt;</span><span style="color: #0550AE">void</span><span style="color: #24292F">&gt; </span><span style="color: #CF222E">|</span><span style="color: #24292F"> </span><span style="color: #0550AE">void</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">try</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">await</span><span style="color: #24292F"> </span><span style="color: #8250DF">action</span><span style="color: #24292F">(state, dispatch)</span></span>
<span class="line"><span style="color: #24292F">    } </span><span style="color: #CF222E">catch</span><span style="color: #24292F"> (error) {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #6E7781">// take appropriate action and report the error</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #8250DF">alert</span><span style="color: #24292F">(</span><span style="color: #0A3069">&#39;The application encountered an error.&#39;</span><span style="color: #24292F">)</span></span>
<span class="line"><span style="color: #24292F">    }</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">return</span><span style="color: #24292F"> (</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">&lt;</span><span style="color: #24292F">AppContext.Provider value</span><span style="color: #CF222E">=</span><span style="color: #24292F">{{ state, execute }}</span><span style="color: #CF222E">&gt;</span></span>
<span class="line"><span style="color: #24292F">      {</span><span style="color: #953800">props</span><span style="color: #24292F">.</span><span style="color: #953800">children</span><span style="color: #24292F">}</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">&lt;/</span><span style="color: #24292F">AppContext.Provider</span><span style="color: #CF222E">&gt;</span></span>
<span class="line"><span style="color: #24292F">  )</span></span>
<span class="line"><span style="color: #24292F">}</span></span></code></pre>
<p>We’ll need to add the <code>AppContextProvider</code> as the root component of the application. Then in a component, we can access the application state and the <code>execute</code> method using the <code>useContext</code> hook.</p>
<pre class="shiki" style="background-color: #ffffff"><code><span class="line"><span style="color: #CF222E">const</span><span style="color: #24292F"> { </span><span style="color: #0550AE">state</span><span style="color: #24292F">, </span><span style="color: #0550AE">execute</span><span style="color: #24292F"> } </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">useContext</span><span style="color: #24292F">(AppContext)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">removeNoteClick</span><span style="color: #24292F">(</span><span style="color: #953800">noteId</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #8250DF">execute</span><span style="color: #24292F">(noteActions.</span><span style="color: #8250DF">removeNote</span><span style="color: #24292F">(noteId))</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">notes</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> state.notes.notes</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6E7781">// rendering the notes</span></span></code></pre>
<p>The source code can be found <a href="https://github.com/toaderflorin/hooks-store">here</a>.</p></section></article><div id="scroller" class="fixed h-[3px] left-0 top-0 bg-[color:var(--color-primary)]"></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2022-01-12-hooks-architecture/";window.___webpackCompilationHash="d3fa4c427fc144b44353";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-30f2bf2a1846f97f91ab.js"],"app":["/app-64aefee3cb3c34cdb251.js"],"component---src-pages-404-js":["/component---src-pages-404-js-94ce966344d1e2d2e5ba.js"],"component---src-pages-index-js":["/component---src-pages-index-js-e58786a723404a670ae5.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-7f2410a55377b3a008b8.js"]};/*]]>*/</script><script src="/polyfill-30f2bf2a1846f97f91ab.js" nomodule=""></script><script src="/app-64aefee3cb3c34cdb251.js" async=""></script><script src="/framework-d9aa49d9654a57a5d41b.js" async=""></script><script src="/webpack-runtime-c9d9abbad510a4a6e37c.js" async=""></script></body></html>