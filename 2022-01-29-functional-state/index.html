<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><style data-href="/styles.9a77c21aedc1c5c896f0.css" data-identity="gatsby-global-css">@font-face{font-family:gilroy;font-weight:400;src:url(/fonts/Gilroy-Regular.ttf)}@font-face{font-family:instrument;src:url(/fonts/Instrument.ttf)}@font-face{font-family:matter;src:url(/fonts/Matter-Regular.ttf)}@font-face{font-family:neuehaas;src:url(/fonts/NeueHaasDisplayRoman.ttf)}@font-face{font-family:lato;src:url(/fonts/Lato-Regular.ttf)}@font-face{font-family:avenir;src:url(/fonts/AvenirLTStd-Roman.otf)}@font-face{font-family:cisco;src:url(/fonts/CiscoSans.ttf)}@font-face{font-family:nexa;src:url(/fonts/Nexa-Book.ttf)}@font-face{font-family:tt;src:url(/fonts/TTHoves-Regular.ttf)}@font-face{font-family:poly;src:url(/fonts/poly.otf)}@font-face{font-family:suisse;src:url(/fonts/SuisseIntl-Regular.ttf)}@font-face{font-family:aktiv;src:url(/fonts/AktivGrotesk-Light.ttf)}@font-face{font-family:Matter;src:url(/fonts/Matter-Light.ttf)}@font-face{font-family:balto;src:url(/fonts/Balto-Book.ttf)}@font-face{font-family:mona;src:url(/fonts/MonaSans-Regular.ttf)}@font-face{font-family:roobert;src:url(/fonts/Roobert-Regular.ttf)}@font-face{font-family:balto;font-weight:700;src:url(/fonts/Balto-Bold.woff2)}@font-face{font-family:now;src:url(/fonts/HelveticaNow.otf)}:root{--color-primary:#ff164c}*,:after,:before{box-sizing:border-box;margin:0}h1,h2,h3,html{margin:0}html{padding:0}pre.shiki{border-radius:5px;padding:15px}code,pre.shiki{font-size:13px}body{color:#373737;font-family:now,serif;font-size:15.5px;font-weight:400;line-height:1.6}h1{font-size:1.8rem}h3{font-size:1.2rem;line-height:2;margin-bottom:-1rem}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{margin:.7rem 0}a{color:var(--color-primary);text-decoration:none}.img{width:100%}.img-side{float:left;width:300px}ul{margin:.7rem 0}.article-icon{float:left;height:64px;margin-right:8px;margin-top:6px;width:64px}.fixed{position:fixed}.relative{position:relative}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mt-3{margin-top:.75rem}.mt-\[40px\]{margin-top:40px}.flex{display:flex}.h-\[100\%\]{height:100%}.h-\[3px\]{height:3px}.h-\[600px\]{height:600px}.h-\[64px\]{height:64px}.w-\[100\%\]{width:100%}.w-\[1000px\]{width:1000px}.w-\[650px\]{width:650px}.w-\[700px\]{width:700px}.cursor-pointer{cursor:pointer}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.rounded{border-radius:.25rem}.rounded-sm{border-radius:.125rem}.bg-\[color\:var\(--color-primary\)\]{background-color:var(--color-primary)}.bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-\[url\(\/img\/an_bk\.jpg\)\]{background-image:url(/img/an_bk.jpg)}.bg-cover{background-size:cover}.bg-fixed{background-attachment:fixed}.p-6{padding:1.5rem}.pt-10{padding-top:2.5rem}.pt-12{padding-top:3rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-\[color\:var\(--color-primary\)\]{color:var(--color-primary)}.text-slate-100{--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgba(0,0,0,.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color)}.shadow-2xl,.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.blur-md{--tw-blur:blur(12px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\:shadow-\[0_0_40px_-15px_rgba\(0\2c 0\2c 0\2c 0\.2\)\]:hover{--tw-shadow:0 0 40px -15px rgba(0,0,0,.2);--tw-shadow-colored:0 0 40px -15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="true"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400&amp;display=swap"/><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=4376dbdae9096a24eda7625764953946" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4376dbdae9096a24eda7625764953946"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header class="global-header"></header><main><div class="fixed top-0 left-0 right-0 text-white bg-slate-800 h-[64px] shadow-lg"><div class="w-[700px] mx-auto flex items-center h-[64px]">florin<b>toader</b></div></div><title>A Different Take On Handling Local State Using Hooks</title><meta name="og:image:secure_url" content="https://florintoader.me/2024-01-08-ddd-bdd/cucumber.jpg"/><meta name="og:description" content=" When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however differences between class components and function components related to how hooks work, which we&#x27;ll look at next. With classes, component state is accessible via this.state, and updating it (and triggering component rerendering) is done via this.setState. In functional components, we use the &lt;i&gt;useState&lt;/i&gt; hook and instead of merging the object we&#x27;re passing in, the state is replaced. "/><article class="w-[700px] mx-auto pt-[150px]" itemscope="" style="margin-top:100px;margin-bottom:20px"><header><h1 itemProp="headline">A Different Take On Handling Local State Using Hooks</h1><p><i>January 28, 2022</i></p></header><section itemProp="articleBody"><p>When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however differences between class components and function components related to how hooks work, which we’ll look at next.</p>
<p>With classes, component state is accessible via <code>this.state</code>, and updating it (and triggering component rerendering) is done via <code>this.setState</code>. In functional components, we use the <code>useState</code> hook and instead of merging the object we’re passing in, the state is replaced. It can be used several times and the intention is to be used for each field we want to track — for example, if we have multiple inputs on the page, we can use the hook for the state of each one of them.</p>
<img src="img.jpg" class="img" />
<p>On first look it seems there’s a simple solution - we can simply merge the state ourselves.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">async</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">loadSection1</span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">try</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">this.</span><span style="color: #82AAFF">setState</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      section1</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">section1</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #A6ACCD">requestState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">RequestState</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">Loading</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">    </span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">data</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #82AAFF">fetchSection1Data</span><span style="color: #F07178">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">this.</span><span style="color: #82AAFF">setState</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      section1</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">section1</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #A6ACCD">requestState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">RequestState</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">Loaded</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #F07178"> </span><span style="color: #89DDFF; font-style: italic">catch</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">this.</span><span style="color: #82AAFF">setState</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      section1</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">section1</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #A6ACCD">requestState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">RequestState</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">Error</span><span style="color: #F07178">      </span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  }) </span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C792EA">async</span><span style="color: #F07178"> </span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #82AAFF">loadSection2</span><span style="color: #89DDFF">()</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">try</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">this.</span><span style="color: #82AAFF">setState</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      section2</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">section1</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #A6ACCD">requestState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">RequestState</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">Loading</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">    </span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">data</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF; font-style: italic">await</span><span style="color: #F07178"> </span><span style="color: #82AAFF">fetchSection1Data</span><span style="color: #F07178">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">this.</span><span style="color: #82AAFF">setState</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      section2</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">section2</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #A6ACCD">requestState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">RequestState</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">Loaded</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #F07178"> </span><span style="color: #89DDFF; font-style: italic">catch</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">this.</span><span style="color: #82AAFF">setState</span><span style="color: #F07178">(</span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      section2</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">section2</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #A6ACCD">requestState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">RequestState</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">Error</span><span style="color: #F07178">      </span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  })</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>Where again <code>RequestState</code> is:</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">type</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">RequestState</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #F07178">Null</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #F07178">Loading</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #F07178">Loaded</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">  </span><span style="color: #F07178">Error</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>We’ve started both actions at the same time. The first action finishes the fetch, updates the state, and triggers a render. Then the second action finishes, but because the function creates a closure around the update method, so state refers to the value when the action started. This means that the second action that finishes will overwrite the results of the other one.</p>
<p>What we is a mutable way of tracking the state. Luckily, React provides a useRef hook that allows us to keep a reference to an object on a per-component basis. The typical use case for it is to store references to UI elements but it can be used to point to any object, so we can store our updated state in it whenever any of the responses return.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">setComponentState</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">newState</span><span style="color: #89DDFF">:</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">any</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">currentState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">stateRef</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">current</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">newState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">currentState</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">....</span><span style="color: #A6ACCD">newState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">this.</span><span style="color: #82AAFF">setState</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">newState</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #A6ACCD">stateRef</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">current</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">newState</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>Finally, necause we find this functionality useful, let’s create a custom hook.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #89DDFF; font-style: italic">import</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">useRef</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">useState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF; font-style: italic">from</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">react</span><span style="color: #89DDFF">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #89DDFF; font-style: italic">export</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF; font-style: italic">default</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">useComponentState</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">initialState</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">internalRef</span><span style="color: #F07178">  </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #82AAFF">useRef</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">initialState</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #89DDFF">[</span><span style="color: #A6ACCD">internalState</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">setInternalState</span><span style="color: #89DDFF">]</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">useState</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">initialState</span><span style="color: #F07178">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #82AAFF">setState</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">)</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">newState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">internalRef</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">current</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">...</span><span style="color: #A6ACCD">state</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">setInternalState</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">newState</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #A6ACCD">internalRef</span><span style="color: #89DDFF">.</span><span style="color: #A6ACCD">current</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">newState</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> state</span><span style="color: #89DDFF">:</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">internalState</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">setState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>Finally, this can be used in our component the same way we would use the regular <code>useState</code> hook:</p>
<pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">StatefulComponent</span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{}</span><span style="color: #A6ACCD">  </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">state</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #A6ACCD">setState</span><span style="color: #F07178"> </span><span style="color: #89DDFF">}</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">useComponentState</span><span style="color: #F07178">(</span><span style="color: #A6ACCD">initialState</span><span style="color: #F07178">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> (</span></span>
<span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">// we ca bind the state here</span></span>
<span class="line"><span style="color: #F07178">  )  </span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre>
<p>Calling <code>setState</code> will trigger a component update.</p></section></article><div id="scroller" class="fixed h-[3px] left-0 top-0 bg-[color:var(--color-primary)]"></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2022-01-29-functional-state/";window.___webpackCompilationHash="637a321acdd1b5389d5a";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-30f2bf2a1846f97f91ab.js"],"app":["/app-60369e9f499d095cafe9.js"],"component---src-pages-404-js":["/component---src-pages-404-js-94ce966344d1e2d2e5ba.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2546621dba4e7d51b6cf.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-01a6191af659c02b47fb.js"]};/*]]>*/</script><script src="/polyfill-30f2bf2a1846f97f91ab.js" nomodule=""></script><script src="/app-60369e9f499d095cafe9.js" async=""></script><script src="/framework-d9aa49d9654a57a5d41b.js" async=""></script><script src="/webpack-runtime-8a07b135dd361bf6baec.js" async=""></script></body></html>