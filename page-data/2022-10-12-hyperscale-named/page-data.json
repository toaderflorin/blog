{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022-10-12-hyperscale-named/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"73752487-7c95-516f-873c-c06c3578ac30","excerpt":"The word cloud native gets thrown around quite a bit, and depending on who you ask, you’ll get significantly different answers. My favorite way to define it is…","html":"<p>The word cloud native gets thrown around quite a bit, and depending on who you ask, you’ll get significantly different answers. My favorite way to define it is this: <em>Does your code run on promise as well as in the cloud, or only in the cloud? What would be a case where your code doesn’t run on premise, or only on premise? A case where that might not be the case is if you are using technologies like CosmosDB or Aurora.</em></p>\n<p>The promise of the cloud is it makes data center operations easy—or easier than they would be if you’d have to manage your own data center, but you can also manage your own private cloud — yes, this involves a significant devops effort, but it can be done. However, there is a class of software that only runs</p>\n<p>But there is also built in software that takes native advantage of the cloud infrastructure.</p>\n<p>You could write your own sharding engine, but you probably don’t want to do that. Alternatively, you could technologies like Vitess or Citus and run your own k8s cluster, which is an entirely acceptable approach, albeit probably not the simplest approach. A truly cloud native approach is to use something like Azure Database Elastic tools. AD tools offer a sharding solution that’s built into the Azure cloud, the only caveat is it’s not transparent, meaning you need to use dedicated .NET code for data dependent routing. Azure provides a shard map manager which allows it to spread to load within the cluster. The shards are kept withing a special database in a dedicated node. A simpler alternative is to use an approach such as Aurora.</p>\n<p>A common theme on this blog is performance optimizations and practical, real-world-oriented development. We talked about sharding, but probably most companies would want to do something other than roll out their custom sharding solution. A very simple way to improve performance is to implement a caching solution on your endpoints. But that still requires going to every endpoint and adding caching logic, thinking about cache eviction, etc.</p>\n<p>Since most applications are significantly more read-heavy than write-heavy, we can use database replication and have multiple read-only replicas. The problem here is we run into CAP theorem limitations. Let’s assume that:</p>\n<p>We are using sync replication: the more replica</p>\n<p>What if we get rid of replication altogether?</p>\n<h3>Azure Hyperscale is truly revolutionary</h3>\n<p>Azure hyperscale separates the compute nodes (the bit that takes care of running complex queries) from the storage nodes. This means that we can scale up the</p>\n<p>Hyperscale is truly cloud-native. Since the page servers are</p>\n<img src=\"hyperscale.png\" class=\"img\" />\n<p>Hyperscale allows two options for read replicas: high availability replicas and named replicas.</p>\n<p>You can have up to four read replicas, and they work transparently. The application code doesn’t even need to know that they are there. Azure will take care of spreading calls to them.</p>\n<p>If you want to further extend your read compute capacity, you can use named replicas.</p>\n<h3>.NET Core Implementation</h3>\n<p>If you are not using, you probably should.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GenericRepository<span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">></span></span> <span class=\"token keyword\">where</span> <span class=\"token class-name\">TEntity</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token keyword\">class</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">internal</span> <span class=\"token class-name\">SchoolContext</span> context<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">internal</span> <span class=\"token class-name\">DbSet<span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">></span></span> dbSet<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">GenericRepository</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SchoolContext</span> context<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context <span class=\"token operator\">=</span> context<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dbSet <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Set</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token return-type class-name\">IEnumerable<span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">></span></span> <span class=\"token function\">Get</span><span class=\"token punctuation\">(</span>\n        <span class=\"token class-name\">Expression<span class=\"token punctuation\">&lt;</span>Func<span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> filter <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">Func<span class=\"token punctuation\">&lt;</span>IQueryable<span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> IOrderedQueryable<span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> orderBy <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> includeProperties <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">IQueryable<span class=\"token punctuation\">&lt;</span>TEntity<span class=\"token punctuation\">></span></span> query <span class=\"token operator\">=</span> dbSet<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>filter <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            query <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span><span class=\"token function\">Where</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> includeProperty <span class=\"token keyword\">in</span> includeProperties<span class=\"token punctuation\">.</span>Split\n            <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> <span class=\"token punctuation\">{</span> <span class=\"token char\">','</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> StringSplitOptions<span class=\"token punctuation\">.</span>RemoveEmptyEntries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            query <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span><span class=\"token function\">Include</span><span class=\"token punctuation\">(</span>includeProperty<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>orderBy <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">orderBy</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> query<span class=\"token punctuation\">.</span><span class=\"token function\">ToList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token return-type class-name\">TEntity</span> <span class=\"token function\">GetByID</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> id<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> dbSet<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TEntity</span> entity<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        dbSet<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> id<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">TEntity</span> entityToDelete <span class=\"token operator\">=</span> dbSet<span class=\"token punctuation\">.</span><span class=\"token function\">Find</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Delete</span><span class=\"token punctuation\">(</span>entityToDelete<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Delete</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TEntity</span> entityToDelete<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Entry</span><span class=\"token punctuation\">(</span>entityToDelete<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>State <span class=\"token operator\">==</span> EntityState<span class=\"token punctuation\">.</span>Detached<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            dbSet<span class=\"token punctuation\">.</span><span class=\"token function\">Attach</span><span class=\"token punctuation\">(</span>entityToDelete<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        dbSet<span class=\"token punctuation\">.</span><span class=\"token function\">Remove</span><span class=\"token punctuation\">(</span>entityToDelete<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">virtual</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Update</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TEntity</span> entityToUpdate<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        dbSet<span class=\"token punctuation\">.</span><span class=\"token function\">Attach</span><span class=\"token punctuation\">(</span>entityToUpdate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        context<span class=\"token punctuation\">.</span><span class=\"token function\">Entry</span><span class=\"token punctuation\">(</span>entityToUpdate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>State <span class=\"token operator\">=</span> EntityState<span class=\"token punctuation\">.</span>Modified<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A typical implementation would look like:</p>\n<p>We can make use of the options functionality patter in C#.</p>","frontmatter":{"title":"Cloud Native Relational Databases Are Truly Game Changing","date":"October 15, 2022","description":"A common theme on this blog is performance optimizations and practical, real-world-oriented development. We talked about sharding, but probably most companies would want to do something other than roll out their custom sharding solution. A very simple way to improve performance is to implement a caching solution on your endpoints. But that still requires going to every endpoint and adding caching logic, thinking about cache eviction, etc.\n\n"}},"previous":{"fields":{"slug":"/2022-05-30-estimations/"},"frontmatter":{"title":"Why It's So Hard To Get Estimations Right?"}},"next":{"fields":{"slug":"/2022-05-30-estimations/"},"frontmatter":{"title":"Why It's So Hard To Get Estimations Right?"}}},"pageContext":{"id":"73752487-7c95-516f-873c-c06c3578ac30"}},"staticQueryHashes":[]}