{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2022-01-29-functional-state/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"5c8e04f1-64b1-5b0e-b9ac-92b9f95bdde8","excerpt":"When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however…","html":"<p>When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however differences between class components and function components related to how hooks work, which we’ll look at next.</p>\n<p>With classes, component state is accessible via <code class=\"language-text\">this.state</code>, and updating it (and triggering component rerendering) is done via <code class=\"language-text\">this.setState</code>. In functional components, we use the <code class=\"language-text\">useState</code> hook and instead of merging the object we’re passing in, the state is replaced. It can be used several times and the intention is to be used for each field we want to track — for example, if we have multiple inputs on the page, we can use the hook for the state of each one of them.</p>\n<img src=\"img.png\" class=\"img\" />\n<p>On first look it seems there’s a simple solution - we can simply merge the state ourselves.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadSection1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n      section1<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>section1<span class=\"token punctuation\">,</span>\n        requestState <span class=\"token operator\">=</span> RequestState<span class=\"token punctuation\">.</span>Loading\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchSection1Data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n      section1<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>section1<span class=\"token punctuation\">,</span>\n        requestState <span class=\"token operator\">=</span> RequestState<span class=\"token punctuation\">.</span>Loaded\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n      section1<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>section1<span class=\"token punctuation\">,</span>\n        requestState <span class=\"token operator\">=</span> RequestState<span class=\"token punctuation\">.</span>Error      \n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadSection2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n      section2<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>section1<span class=\"token punctuation\">,</span>\n        requestState <span class=\"token operator\">=</span> RequestState<span class=\"token punctuation\">.</span>Loading\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchSection1Data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n      section2<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>section2<span class=\"token punctuation\">,</span>\n        requestState <span class=\"token operator\">=</span> RequestState<span class=\"token punctuation\">.</span>Loaded\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n      section2<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>section2<span class=\"token punctuation\">,</span>\n        requestState <span class=\"token operator\">=</span> RequestState<span class=\"token punctuation\">.</span>Error      \n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Where again <code class=\"language-text\">RequestState</code> is:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">RequestState</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Null<span class=\"token punctuation\">,</span>\n  Loading<span class=\"token punctuation\">,</span>\n  Loaded<span class=\"token punctuation\">,</span>\n  Error\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We’ve started both actions at the same time. The first action finishes the fetch, updates the state, and triggers a render. Then the second action finishes, but because the function creates a closure around the update method, so state refers to the value when the action started. This means that the second action that finishes will overwrite the results of the other one.</p>\n<p>What we is a mutable way of tracking the state. Luckily, React provides a useRef hook that allows us to keep a reference to an object on a per-component basis. The typical use case for it is to store references to UI elements but it can be used to point to any object, so we can store our updated state in it whenever any of the responses return.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">setComponentState</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">newState<span class=\"token operator\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> currentState <span class=\"token operator\">=</span> stateRef<span class=\"token punctuation\">.</span>current\n  <span class=\"token keyword\">const</span> newState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>currentState<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>newState <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>newState<span class=\"token punctuation\">)</span>\n  stateRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> newState\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Finally, necause we find this functionality useful, let’s create a custom hook.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRef<span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useComponentState</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">initialState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> internalRef  <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span>initialState<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>internalState<span class=\"token punctuation\">,</span> setInternalState<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n    <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>initialState<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> newState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>internalRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>state <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">setInternalState</span><span class=\"token punctuation\">(</span>newState<span class=\"token punctuation\">)</span>\n    internalRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> newState\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> state<span class=\"token operator\">:</span> internalState<span class=\"token punctuation\">,</span> setState <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Finally, this can be used in our component the same way we would use the regular <code class=\"language-text\">useState</code> hook:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">StatefulComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> state<span class=\"token punctuation\">,</span> setState <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> \n    <span class=\"token function\">useComponentState</span><span class=\"token punctuation\">(</span>initialState<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// we ca bind the state here</span>\n  <span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Calling <code class=\"language-text\">setState</code> will trigger a component update.</p>","frontmatter":{"title":"A Different Take On Handling Local State Using Hooks","date":"January 28, 2022","description":" When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however differences between class components and function components related to how hooks work, which we'll look at next. With classes, component state is accessible via this.state, and updating it (and triggering component rerendering) is done via this.setState. In functional components, we use the <i>useState</i> hook and instead of merging the object we're passing in, the state is replaced. "}},"previous":{"fields":{"slug":"/2022-04-09-cap/"},"frontmatter":{"title":"The CAP Theorem Hugely Oversimplifies Things"}},"next":{"fields":{"slug":"/2022-04-09-cap/"},"frontmatter":{"title":"The CAP Theorem Hugely Oversimplifies Things"}}},"pageContext":{"id":"5c8e04f1-64b1-5b0e-b9ac-92b9f95bdde8"}},
    "staticQueryHashes": []}