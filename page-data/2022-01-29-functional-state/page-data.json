{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022-01-29-functional-state/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"64f93734-c6f1-5b74-9e02-a8c63b0054f5","excerpt":"When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however…","html":"<p>When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however differences between class components and function components related to how hooks work, which we’ll look at next.</p>\n<p>With classes, component state is accessible via <code>this.state</code>, and updating it (and triggering component rerendering) is done via <code>this.setState</code>. In functional components, we use the <code>useState</code> hook and instead of merging the object we’re passing in, the state is replaced. It can be used several times and the intention is to be used for each field we want to track — for example, if we have multiple inputs on the page, we can use the hook for the state of each one of them.</p>\n<img src=\"img.png\" class=\"img\" />\n<p>On first look it seems there’s a simple solution - we can simply merge the state ourselves.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #CF222E\">async</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">function</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">loadSection1</span><span style=\"color: #24292F\">() {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">try</span><span style=\"color: #24292F\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #0550AE\">this</span><span style=\"color: #24292F\">.</span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">({</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      section1: {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state.section1,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        requestState </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> RequestState.Loading</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    })</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">data</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">await</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">fetchSection1Data</span><span style=\"color: #24292F\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #0550AE\">this</span><span style=\"color: #24292F\">.</span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">({</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      section1: {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state.section1,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        requestState </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> RequestState.Loaded</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    })</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  } </span><span style=\"color: #CF222E\">catch</span><span style=\"color: #24292F\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #0550AE\">this</span><span style=\"color: #24292F\">.</span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">({</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      section1: {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state.section1,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        requestState </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> RequestState.Error      </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  }) </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #CF222E\">async</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">function</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">loadSection2</span><span style=\"color: #24292F\">() {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">try</span><span style=\"color: #24292F\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #0550AE\">this</span><span style=\"color: #24292F\">.</span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">({</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      section2: {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state.section1,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        requestState </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> RequestState.Loading</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    })</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">data</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">await</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">fetchSection1Data</span><span style=\"color: #24292F\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #0550AE\">this</span><span style=\"color: #24292F\">.</span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">({</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      section2: {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state.section2,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        requestState </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> RequestState.Loaded</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    })</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  } </span><span style=\"color: #CF222E\">catch</span><span style=\"color: #24292F\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #0550AE\">this</span><span style=\"color: #24292F\">.</span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">({</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      section2: {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state.section2,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">        requestState </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> RequestState.Error      </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">      }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  })</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">}</span></span></code></pre>\n<p>Where again <code>RequestState</code> is:</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #CF222E\">type</span><span style=\"color: #24292F\"> </span><span style=\"color: #953800\">RequestState</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #953800\">Null</span><span style=\"color: #24292F\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #953800\">Loading</span><span style=\"color: #24292F\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #953800\">Loaded</span><span style=\"color: #24292F\">,</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #953800\">Error</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">}</span></span></code></pre>\n<p>We’ve started both actions at the same time. The first action finishes the fetch, updates the state, and triggers a render. Then the second action finishes, but because the function creates a closure around the update method, so state refers to the value when the action started. This means that the second action that finishes will overwrite the results of the other one.</p>\n<p>What we is a mutable way of tracking the state. Luckily, React provides a useRef hook that allows us to keep a reference to an object on a per-component basis. The typical use case for it is to store references to UI elements but it can be used to point to any object, so we can store our updated state in it whenever any of the responses return.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #CF222E\">function</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">setComponentState</span><span style=\"color: #24292F\">(</span><span style=\"color: #953800\">newState</span><span style=\"color: #CF222E\">:</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">any</span><span style=\"color: #24292F\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">currentState</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> stateRef.current</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">newState</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> { </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">currentState, </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">.newState }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #0550AE\">this</span><span style=\"color: #24292F\">.</span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">(newState)</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  stateRef.current </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> newState</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">}</span></span></code></pre>\n<p>Finally, necause we find this functionality useful, let’s create a custom hook.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #CF222E\">import</span><span style=\"color: #24292F\"> { useRef, useState } </span><span style=\"color: #CF222E\">from</span><span style=\"color: #24292F\"> </span><span style=\"color: #0A3069\">&#39;react&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #CF222E\">export</span><span style=\"color: #953800\"> </span><span style=\"color: #CF222E\">default</span><span style=\"color: #953800\"> </span><span style=\"color: #CF222E\">function</span><span style=\"color: #953800\"> </span><span style=\"color: #8250DF\">useComponentState</span><span style=\"color: #953800\">(initialState) </span><span style=\"color: #24292F\">{</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">internalRef</span><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">useRef</span><span style=\"color: #24292F\">(initialState)</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> [</span><span style=\"color: #0550AE\">internalState</span><span style=\"color: #24292F\">, </span><span style=\"color: #0550AE\">setInternalState</span><span style=\"color: #24292F\">] </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #8250DF\">useState</span><span style=\"color: #24292F\">(initialState)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">function</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">setState</span><span style=\"color: #24292F\">(</span><span style=\"color: #953800\">state</span><span style=\"color: #24292F\">) {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> </span><span style=\"color: #0550AE\">newState</span><span style=\"color: #24292F\"> </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> { </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">internalRef.current, </span><span style=\"color: #CF222E\">...</span><span style=\"color: #24292F\">state }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #8250DF\">setInternalState</span><span style=\"color: #24292F\">(newState)</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    internalRef.current </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> newState</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">return</span><span style=\"color: #24292F\"> { state: internalState, setState }</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">}</span></span></code></pre>\n<p>Finally, this can be used in our component the same way we would use the regular <code>useState</code> hook:</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #CF222E\">function</span><span style=\"color: #24292F\"> </span><span style=\"color: #8250DF\">StatefulComponent</span><span style=\"color: #24292F\">() {}  {</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">const</span><span style=\"color: #24292F\"> { </span><span style=\"color: #0550AE\">state</span><span style=\"color: #24292F\">, </span><span style=\"color: #0550AE\">setState</span><span style=\"color: #24292F\"> } </span><span style=\"color: #CF222E\">=</span><span style=\"color: #24292F\"> </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #8250DF\">useComponentState</span><span style=\"color: #24292F\">(initialState)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #24292F\">  </span><span style=\"color: #CF222E\">return</span><span style=\"color: #24292F\"> (</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">    </span><span style=\"color: #6E7781\">// we ca bind the state here</span></span>\n<span class=\"line\"><span style=\"color: #24292F\">  )  </span></span>\n<span class=\"line\"><span style=\"color: #24292F\">}</span></span></code></pre>\n<p>Calling <code>setState</code> will trigger a component update.</p>","frontmatter":{"title":"A Different Take On Handling Local State Using Hooks","date":"January 28, 2022","description":" When implementing simple React applications, Redux might cause significant overhead, and just using component state might be enough. There are however differences between class components and function components related to how hooks work, which we'll look at next. With classes, component state is accessible via this.state, and updating it (and triggering component rerendering) is done via this.setState. In functional components, we use the <i>useState</i> hook and instead of merging the object we're passing in, the state is replaced. "}},"previous":{"fields":{"slug":"/2022-05-30-estimations/"},"frontmatter":{"title":"Why It's So Hard To Get Estimations Right?"}},"next":{"fields":{"slug":"/2022-05-30-estimations/"},"frontmatter":{"title":"Why It's So Hard To Get Estimations Right?"}}},"pageContext":{"id":"64f93734-c6f1-5b74-9e02-a8c63b0054f5"}},"staticQueryHashes":[]}