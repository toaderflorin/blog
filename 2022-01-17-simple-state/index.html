<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><style data-href="/styles.36ef0a7f785eba6d23fa.css" data-identity="gatsby-global-css">@font-face{font-family:gilroy;font-weight:400;src:url(/fonts/Gilroy-Regular.ttf)}@font-face{font-family:instrument;src:url(/fonts/Instrument.ttf)}@font-face{font-family:matter;src:url(/fonts/Matter-Regular.ttf)}@font-face{font-family:cisco;src:url(/font/CiscoSans.ttf)}@font-face{font-family:proxima;src:url(/fonts/TTHoves-Regular.ttf)}@font-face{font-family:suisse;src:url(/fonts/SuisseIntl-Light.otf)}@font-face{font-family:aktiv;src:url(/fonts/AktivGrotesk-Light.ttf)}@font-face{font-family:helv;src:url(/fonts/HelveticaNowDisplay-Regular.otf)}@font-face{font-family:balto;src:url(/fonts/Balto-Book.ttf)}@font-face{font-family:balto;font-weight:700;src:url(/fonts/Balto-Bold.woff2)}@font-face{font-family:neue;src:url(/fonts/Balto-Bold.woff2)}:root{--color-primary:#ff164c}*,:after,:before{box-sizing:border-box;margin:0}h1,h2,h3,html{margin:0}html{padding:0}pre.shiki{background-color:#fcfcfc!important;border:1px solid #eaeaea;border-radius:5px;margin-left:-17px;margin-right:-17px;padding:17px}code,pre.shiki{font-size:13px}body{color:#333;font-family:balto,serif;font-size:15px;line-height:1.55}h1{font-size:1.8rem}h3{font-size:1.1rem;line-height:2;margin-bottom:-1rem}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{margin:.7rem 0}a{color:var(--color-primary);text-decoration:none}.img{width:100%}.img-side{float:left;width:300px}ul{margin:.7rem 0}.article-icon{float:left;height:64px;margin-right:8px;margin-top:6px;width:64px}.fixed{position:fixed}.relative{position:relative}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mt-3{margin-top:.75rem}.mt-\[40px\]{margin-top:40px}.flex{display:flex}.h-\[100\%\]{height:100%}.h-\[3px\]{height:3px}.h-\[600px\]{height:600px}.h-\[64px\]{height:64px}.w-\[100\%\]{width:100%}.w-\[1000px\]{width:1000px}.w-\[650px\]{width:650px}.w-\[700px\]{width:700px}.cursor-pointer{cursor:pointer}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.rounded-sm{border-radius:.125rem}.bg-\[color\:var\(--color-primary\)\]{background-color:var(--color-primary)}.bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-\[url\(\/img\/an_bk\.jpg\)\]{background-image:url(/img/an_bk.jpg)}.bg-cover{background-size:cover}.bg-fixed{background-attachment:fixed}.p-6{padding:1.5rem}.pt-12{padding-top:3rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-\[color\:var\(--color-primary\)\]{color:var(--color-primary)}.text-slate-100{--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgba(0,0,0,.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color)}.shadow-2xl,.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.blur-md{--tw-blur:blur(12px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\:shadow-\[0_0_40px_-15px_rgba\(0\2c 0\2c 0\2c 0\.2\)\]:hover{--tw-shadow:0 0 40px -15px rgba(0,0,0,.2);--tw-shadow-colored:0 0 40px -15px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="true"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400&amp;display=swap"/><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=4376dbdae9096a24eda7625764953946" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4376dbdae9096a24eda7625764953946"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header class="global-header"></header><main><div class="fixed top-0 left-0 right-0 text-white bg-slate-800 h-[64px] shadow-lg"><div class="w-[700px] mx-auto flex items-center h-[64px]">florin<b>toader</b></div></div><article class="w-[700px] mx-auto pt-[150px]" itemscope="" style="margin-top:100px;margin-bottom:20px"><header><h1 itemProp="headline">Simplifying State Handling</h1><p><i>January 16, 2022</i></p></header><section itemProp="articleBody"><p>In the previous example, we went over a global store app pattern that emulates Redux. The main advantage of this approach is familiarity, meaning that developers can structure their projects using a similar folder/code structure. There is, however, an alternative approach popularized by  Svelte, which is less verbose. While this is a familiar approach, many developers feel that the single-store architectural approach leads to bad software patterns. Dan Abramov has famously likened asynchronicity and state mutations, yet having a global state object can easily lead to situations where existing functionality can rely on existing state (state that was fetched previously). Moreover, oftentimes users bookmark or refresh pages, which can lead to problems. Having a lot of stateful data can lead to brittle code because it relies on previously executed actions which might break the flow.</p>
<p>(As a side note here, a lot of applications are clientside logic heavy and they do a lot of inner joins and computations where this information might be better sent to the server)</p>
<p>One approach that client-side applications can borrow from server-side applications is to treat the URL as the current “state” and render solely based on that. That way, we ensure that the page always renders the same regardless of whether it was the result of client-side navigation or the user refreshing the page. An (imperfect) analogy that can be used here is that of pure functions - the result of the pure function always depends on the input parameters (in our case the URL), not some other application state. The analogy is imperfect because the page would of course render based on the server-side state. React’s functional components lend themselves well to this approach. We can use a simple example: imagine a page that displays products.</p>
<blockquote>
<p>/products</p>
</blockquote>
<p>By default, the page would display a list of products on sale or popular products.</p>
<blockquote>
<p>/products?search=searchterm</p>
</blockquote>
<p>The following URL would show the user a search result list. Let’s consider the following scenario: a lot of sites allow the user to have a list of favorites. If a certain product is in the favorite list, the application shows an icon next to it. Instead of relying on a single global state object, we would have an individual store just for the product page that we would populate on URL navigation (which can be clientside or serverside).</p>
<p>Our store uses the <code>useReducer</code> hook for reasons explained in the following article. The aim is to create a personal organizer application that has two sections: notes and tasks. The note page and task page structure are similar, so we’ll present the code for notes as an example.</p>
<pre class="shiki" style="background-color: #ffffff"><code><span class="line"><span style="color: #CF222E">import</span><span style="color: #24292F"> { useReducer } </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;react&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">Task</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">id</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">TaskStoreState</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #953800">tasks</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Task</span><span style="color: #24292F">[]</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">type</span><span style="color: #24292F"> </span><span style="color: #953800">Action</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">any</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">export</span><span style="color: #953800"> </span><span style="color: #CF222E">default</span><span style="color: #953800"> </span><span style="color: #CF222E">function</span><span style="color: #953800"> </span><span style="color: #8250DF">useLoginStore</span><span style="color: #953800">(initialState</span><span style="color: #CF222E">:</span><span style="color: #953800"> TaskStoreState) </span><span style="color: #24292F">{</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">state</span><span style="color: #24292F">, </span><span style="color: #0550AE">dispatch</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">useReducer</span><span style="color: #24292F">(reducer, initialState)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">addTask</span><span style="color: #24292F">(</span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #8250DF">dispatch</span><span style="color: #24292F">({ type: </span><span style="color: #0A3069">&#39;ADD_TASK&#39;</span><span style="color: #24292F">, description })</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">removeTask</span><span style="color: #24292F">(</span><span style="color: #953800">id</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #8250DF">dispatch</span><span style="color: #24292F">({ type: </span><span style="color: #0A3069">&#39;REMOVE_TASK&#39;</span><span style="color: #24292F">, id })</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">updateTask</span><span style="color: #24292F">(</span><span style="color: #953800">id</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">, </span><span style="color: #953800">description</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #0550AE">string</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #8250DF">dispatch</span><span style="color: #24292F">({ type: </span><span style="color: #0A3069">&#39;UPDATE_TASK&#39;</span><span style="color: #24292F">, id, description })</span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">    state,</span></span>
<span class="line"><span style="color: #24292F">    actions: {</span></span>
<span class="line"><span style="color: #24292F">      addTask,</span></span>
<span class="line"><span style="color: #24292F">      removeTask,</span></span>
<span class="line"><span style="color: #24292F">      updateTask</span></span>
<span class="line"><span style="color: #24292F">    }  </span></span>
<span class="line"><span style="color: #24292F">  }</span></span>
<span class="line"><span style="color: #24292F">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">reducer</span><span style="color: #24292F">(</span><span style="color: #953800">state</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">TaskStoreState</span><span style="color: #24292F">, </span><span style="color: #953800">action</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Action</span><span style="color: #24292F">) {</span></span>
<span class="line"><span style="color: #24292F">  </span><span style="color: #CF222E">switch</span><span style="color: #24292F"> (action.type) {</span></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">case</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;ADD_TASKS&#39;</span><span style="color: #24292F">: {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">        </span><span style="color: #CF222E">...</span><span style="color: #24292F">state,</span></span>
<span class="line"><span style="color: #24292F">        tasks: [</span><span style="color: #CF222E">...</span><span style="color: #24292F">state.tasks, {</span></span>
<span class="line"><span style="color: #24292F">          id: </span><span style="color: #0A3069">&#39;newid&#39;</span><span style="color: #24292F">,</span></span>
<span class="line"><span style="color: #24292F">          description: action.description</span></span>
<span class="line"><span style="color: #24292F">        }]</span></span>
<span class="line"><span style="color: #24292F">      }</span></span>
<span class="line"><span style="color: #24292F">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">case</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;REMOVE_TASK&#39;</span><span style="color: #24292F">: {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">        </span><span style="color: #CF222E">...</span><span style="color: #24292F">state,</span></span>
<span class="line"><span style="color: #24292F">        tasks: state.tasks.</span><span style="color: #8250DF">filter</span><span style="color: #24292F">((</span><span style="color: #953800">task</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Task</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> task.id </span><span style="color: #CF222E">!==</span><span style="color: #24292F"> action.id)</span></span>
<span class="line"><span style="color: #24292F">      }</span></span>
<span class="line"><span style="color: #24292F">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292F">    </span><span style="color: #CF222E">case</span><span style="color: #24292F"> </span><span style="color: #0A3069">&#39;UPDATE_TASK&#39;</span><span style="color: #24292F">: {</span></span>
<span class="line"><span style="color: #24292F">      </span><span style="color: #CF222E">return</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">        </span><span style="color: #CF222E">...</span><span style="color: #24292F">state,</span></span>
<span class="line"><span style="color: #24292F">        tasks: state.tasks.</span><span style="color: #8250DF">map</span><span style="color: #24292F">((</span><span style="color: #953800">task</span><span style="color: #CF222E">:</span><span style="color: #24292F"> </span><span style="color: #953800">Task</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">          </span><span style="color: #CF222E">if</span><span style="color: #24292F"> (task.id </span><span style="color: #CF222E">!==</span><span style="color: #24292F"> action.id) {</span></span>
<span class="line"><span style="color: #24292F">            </span><span style="color: #CF222E">return</span><span style="color: #24292F"> task</span></span>
<span class="line"><span style="color: #24292F">          } </span><span style="color: #CF222E">else</span><span style="color: #24292F"> {</span></span>
<span class="line"><span style="color: #24292F">    </span></span></code></pre></section></article><div id="scroller" class="fixed h-[3px] left-0 top-0 bg-[color:var(--color-primary)]"></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2022-01-17-simple-state/";window.___webpackCompilationHash="d3fa4c427fc144b44353";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-30f2bf2a1846f97f91ab.js"],"app":["/app-64aefee3cb3c34cdb251.js"],"component---src-pages-404-js":["/component---src-pages-404-js-94ce966344d1e2d2e5ba.js"],"component---src-pages-index-js":["/component---src-pages-index-js-e58786a723404a670ae5.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-7f2410a55377b3a008b8.js"]};/*]]>*/</script><script src="/polyfill-30f2bf2a1846f97f91ab.js" nomodule=""></script><script src="/app-64aefee3cb3c34cdb251.js" async=""></script><script src="/framework-d9aa49d9654a57a5d41b.js" async=""></script><script src="/webpack-runtime-c9d9abbad510a4a6e37c.js" async=""></script></body></html>