<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.7"/><style data-href="/styles.0efa7660d3a0dc206572.css" data-identity="gatsby-global-css">@font-face{font-family:gilroy;font-weight:400;src:url(/fonts/Gilroy-Regular.ttf)}@font-face{font-family:instrument;src:url(/fonts/Instrument.ttf)}:root{--size-none:0;--size-100:1px;--size-200:2px;--size-300:3px;--size-400:5px;--size-500:8px;--size-600:12px;--size-700:17px;--size-800:23px;--color-primary:#ff164c}*,:after,:before{box-sizing:border-box;margin:0}h1,h2,h3{margin:0}h3{font-size:24px}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;margin:0;padding:0}body{color:#222;font-family:instrument,sans-serif,serif;font-size:11pt;line-height:1.65}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{margin:0 0 .5rem}a{color:var(--color-primary);text-decoration:none}.img{width:100%}.img-side{float:left;width:300px}.article-icon{float:left;height:64px;margin-right:8px;margin-top:6px;width:64px}code[class*=language-],pre[class*=language-]{background:#282c34;color:#abb2bf;direction:ltr;font-family:Menlo,Consolas,DejaVu Sans Mono,monospace;font-size:14px;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:2;tab-size:2;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection{background:#3e4451;color:inherit;text-shadow:none}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.3em;white-space:normal}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}.token.cdata,.token.comment,.token.prolog{color:#5c6370}.token.doctype,.token.entity,.token.punctuation{color:#abb2bf}.token.atrule,.token.attr-name,.token.boolean,.token.class-name,.token.constant,.token.number{color:#d19a66}.token.keyword{color:#c678dd}.token.deleted,.token.important,.token.property,.token.symbol,.token.tag{color:#e06c75}.token.attr-value,.token.attr-value>.token.punctuation,.token.builtin,.token.char,.token.inserted,.token.regex,.token.selector,.token.string{color:#98c379}.token.function,.token.operator,.token.variable{color:#61afef}.token.url{color:#56b6c2}.token.attr-value>.token.punctuation.attr-equals,.token.special-attr>.token.attr-value>.token.value.css{color:#abb2bf}.language-css .token.selector{color:#e06c75}.language-css .token.property{color:#abb2bf}.language-css .token.function,.language-css .token.url>.token.function{color:#56b6c2}.language-css .token.url>.token.string.url{color:#98c379}.language-css .token.atrule .token.rule,.language-css .token.important,.language-javascript .token.operator{color:#c678dd}.language-javascript .token.template-string>.token.interpolation>.token.interpolation-punctuation.punctuation{color:#be5046}.language-json .token.operator{color:#abb2bf}.language-json .token.null.keyword{color:#d19a66}.language-markdown .token.url,.language-markdown .token.url-reference.url>.token.string,.language-markdown .token.url>.token.operator{color:#abb2bf}.language-markdown .token.url>.token.content{color:#61afef}.language-markdown .token.url-reference.url,.language-markdown .token.url>.token.url{color:#56b6c2}.language-markdown .token.blockquote.punctuation,.language-markdown .token.hr.punctuation{color:#5c6370;font-style:italic}.language-markdown .token.code-snippet{color:#98c379}.language-markdown .token.bold .token.content{color:#d19a66}.language-markdown .token.italic .token.content{color:#c678dd}.language-markdown .token.list.punctuation,.language-markdown .token.strike .token.content,.language-markdown .token.strike .token.punctuation,.language-markdown .token.title.important>.token.punctuation{color:#e06c75}.token.bold{font-weight:700}.token.comment,.token.italic{font-style:italic}.token.entity{cursor:help}.token.namespace{opacity:.8}.token.token.cr:before,.token.token.lf:before,.token.token.space:before,.token.token.tab:not(:empty):before{color:rgba(171,178,191,.15);text-shadow:none}div.code-toolbar>.toolbar.toolbar>.toolbar-item{margin-right:.4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span{background:#3a3f4b;border-radius:.3em;color:#828997;padding:.1em .4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:hover{background:#3e4451;color:#abb2bf}.line-highlight.line-highlight{background:rgba(153,187,255,.04)}.line-highlight.line-highlight:before,.line-highlight.line-highlight[data-end]:after{background:#3a3f4b;border-radius:.3em;box-shadow:0 2px 0 0 rgba(0,0,0,.2);color:#abb2bf;padding:.1em .6em}pre[id].linkable-line-numbers.linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:rgba(153,187,255,.04)}.command-line .command-line-prompt,.line-numbers.line-numbers .line-numbers-rows{border-right-color:rgba(171,178,191,.15)}.command-line .command-line-prompt>span:before,.line-numbers .line-numbers-rows>span:before{color:#636d83}.rainbow-braces .token.token.punctuation.brace-level-1,.rainbow-braces .token.token.punctuation.brace-level-5,.rainbow-braces .token.token.punctuation.brace-level-9{color:#e06c75}.rainbow-braces .token.token.punctuation.brace-level-10,.rainbow-braces .token.token.punctuation.brace-level-2,.rainbow-braces .token.token.punctuation.brace-level-6{color:#98c379}.rainbow-braces .token.token.punctuation.brace-level-11,.rainbow-braces .token.token.punctuation.brace-level-3,.rainbow-braces .token.token.punctuation.brace-level-7{color:#61afef}.rainbow-braces .token.token.punctuation.brace-level-12,.rainbow-braces .token.token.punctuation.brace-level-4,.rainbow-braces .token.token.punctuation.brace-level-8{color:#c678dd}pre.diff-highlight>code .token.token.deleted:not(.prefix),pre>code.diff-highlight .token.token.deleted:not(.prefix){background-color:rgba(255,82,102,.15)}pre.diff-highlight>code .token.token.deleted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.deleted:not(.prefix)::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::selection{background-color:rgba(251,86,105,.25)}pre.diff-highlight>code .token.token.inserted:not(.prefix),pre>code.diff-highlight .token.token.inserted:not(.prefix){background-color:rgba(25,255,91,.15)}pre.diff-highlight>code .token.token.inserted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.inserted:not(.prefix)::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::selection{background-color:rgba(56,224,98,.25)}.prism-previewer-gradient.prism-previewer-gradient div,.prism-previewer.prism-previewer:before{border-color:#262931}.prism-previewer-color.prism-previewer-color:before,.prism-previewer-easing.prism-previewer-easing:before,.prism-previewer-gradient.prism-previewer-gradient div{border-radius:.3em}.prism-previewer.prism-previewer:after{border-top-color:#262931}.prism-previewer-flipped.prism-previewer-flipped.after{border-bottom-color:#262931}.prism-previewer-angle.prism-previewer-angle:before,.prism-previewer-easing.prism-previewer-easing,.prism-previewer-time.prism-previewer-time:before{background:#31363f}.prism-previewer-angle.prism-previewer-angle circle,.prism-previewer-time.prism-previewer-time circle{stroke:#abb2bf;stroke-opacity:1}.prism-previewer-easing.prism-previewer-easing circle,.prism-previewer-easing.prism-previewer-easing line,.prism-previewer-easing.prism-previewer-easing path{stroke:#abb2bf}.prism-previewer-easing.prism-previewer-easing circle{fill:transparent}#header-container{background-image:url(/img/bw.jpg);background-position:bottom;background-size:cover;grid-template-columns:1fr 1fr;position:fixed;z-index:-2}#header,#header-container{color:#fff;height:50vh;left:0;right:0;top:0}#header{align-items:center;border-radius:5px;display:flex;justify-content:center;padding:12px}#lower{display:grid;grid-template-columns:1fr 1fr}.centered{align-items:center;display:flex;justify-content:center}.post-list-item{box-sizing:content-box;cursor:pointer;margin-left:-25px;margin-right:-25px;padding:25px}.post-list-item:hover{box-shadow:0 0 40px 0 rgba(0,0,0,.1);transition:.25s}.post-read-more{color:#000;font-size:13px;font-weight:600;margin-top:5px}#main{box-shadow:0 0 20px 0 #000}#main,#main-inner{background-color:#fff}#main-inner{margin:0 auto;width:650px}#inner{align-items:center;display:flex;height:70px;margin:0 auto;padding:15px;width:800px}#first{background-color:#111;box-shadow:0 0 10px rgba(0,0,0,.8);color:#fff;height:70px;left:0;position:fixed;right:0;top:0}.content{margin:auto;width:700px}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="true"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400&amp;display=swap"/><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=4376dbdae9096a24eda7625764953946" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4376dbdae9096a24eda7625764953946"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4376dbdae9096a24eda7625764953946"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header class="global-header"></header><main><div id="first"><div id="inner"><div>florin<b>toader</b></div></div></div><div class="content"><article class="blog-post" itemscope="" itemType="http://schema.org/Article" style="margin-top:150px"><header><h1 itemProp="headline">React Hooks Can Be Confusing</h1><p>November 18, 2021</p></header><section itemProp="articleBody"><p>React’s development history is widely documented and was developed for internal use at Facebook, as it is the case with a lot of libraries, and for quite some time it was ES5 only — ES6 support of course followed, but the team quite quickly realized that if a component doesn’t need to maintain an internal state, there’s no need for it to be a class, and one of the major additions of v14.0 were stateless functional components. Not long after, the <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">container / presentational pattern</a> appeared, where the state changes would be handled in a wrapping class component, and the inner child component would handle the presentation part.</p>
<p>The functional syntax became popular with quite a few developers — after all, languages like Elm are quite popular these days.</p>
<img src="hooks.jpg" class="img" />
<p>The question then becomes: how does one keep the functional syntax and, at the same time, allows for the use of state in a component? The answer is, of course, hooks. Also, changing the syntax doesn’t mean the component state or lifecycle are going away.</p>
<p>There’s a <code class="language-text">useState</code> hook, for example. There’s also a <code class="language-text">useEffect</code>, and we’ll look at both in a moment. Let’s consider a simple application that fetches some data from an API and then does something with it.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tasks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    isTasksLoading<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tasks <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">fetchTasks</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token comment">// the empty dependency array indicates the effect runs on component mount </span>
  <span class="token comment">// and only once</span>
  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">...</span> code to render
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The first thing that’s very apparent with hooks is we no longer have lifecycle methods like <code class="language-text">componentDidMount</code> or <code class="language-text">componentWillReceiveProps</code>, so we need to rely on a different mechanism — the  <code class="language-text">useEffect</code> hook fills that role now. If we want to react to the component being mounted, we can pass in an empty dependency array. If we want to emulate the <code class="language-text">componentWillReceiveProps</code> we can pass in the props as dependencies.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span> <span class="token operator">=</span> props

  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tasks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    isTasksLoading<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>  

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tasks <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>
    <span class="token function">fetchTasks</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">[</span>currentUser<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">...</span> code to render
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>It’s worth pointing out that the way <code class="language-text">useState</code> works with hooks is different that the way <code class="language-text">useState</code> works with class components.</p>
<ol>
<li>With class components, it merges the new state into the old state, via the JS spread syntax.</li>
<li>With functional components, it simply replaces the state object.</li>
<li>You can use <code class="language-text">useState</code> multiple times in functional components and have different instances of state.</li>
</ol>
<p>And extremely important, with functional components there is no <code class="language-text">this.state</code>. Also, functional components are <em>closures</em>, which means they have their own lexical context, and so they capture the values of variables declared in the function when those functions were called. So in our case, when the response comes back from the server, the value of <span class="code">state` is the same as it was when the component was called. Typically, this wouldn’t be a problem, especially because you can use the <span class="code">useState</span> hook multiple times, and you can have different disjointed pieces of state.</p>
<p><em>The main problem with this approach arises if you are trying to use one single view model object as state and merge new state prop values into it if you have to deal with concurrency.</em></p>
<p>The typical case in which this would happen is if you aren’t using a store manager like Redux, and use a <a href="https://reactjs.org/docs/lifting-state-up.html">lift state up</a> approach. Typically, this would mean that you are usinng the root component, or the root component route as a state manager and you are using prop drilling and callbacks.</p>
<p>So let’s illustrate the point. Let’s say that aside from tasks, we also want the user to be able to scribble down and manage notes, and we need to change the data we’re displaying when the currently logged in user changes.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span> <span class="token operator">=</span> props

  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tasks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    notes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    tasksLoading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    notesLoading<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> tasks<span class="token punctuation">,</span> tasksLoading<span class="token punctuation">,</span> notes<span class="token punctuation">,</span> notesLoading <span class="token punctuation">}</span> <span class="token operator">=</span> state

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tasks <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>    
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      tasks<span class="token punctuation">,</span>
      tasksLoading<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchNotes</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      notesLoading<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getNotes</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      notes<span class="token punctuation">,</span>
      notesLoading<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>  
  <span class="token punctuation">}</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">[</span>currentUser<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>Tasks tasks<span class="token operator">=</span><span class="token punctuation">{</span>tasks<span class="token punctuation">}</span> tasksLoading<span class="token operator">=</span><span class="token punctuation">{</span>tasksLoading<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Notes notes<span class="token operator">=</span><span class="token punctuation">{</span>notes<span class="token punctuation">}</span> notesLoading<span class="token operator">=</span><span class="token punctuation">{</span>notesLoading<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>While not necessarily easy to spot, we now have a racing condition.</p>
<p>We can change it like this.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span> <span class="token operator">=</span> props

  <span class="token keyword">const</span> <span class="token punctuation">[</span>tasks<span class="token punctuation">,</span> setTasks<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    tasks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    tasksLoading<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>notes<span class="token punctuation">,</span> setNotes<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    notes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    notesLoading<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tasks <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>    
    <span class="token function">setTasks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      
      tasks<span class="token punctuation">,</span>
      tasksLoading<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchNotes</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      notes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      notesLoading<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getNotes</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      notes<span class="token punctuation">,</span>
      notesLoading<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>  
  <span class="token punctuation">}</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>
    <span class="token function">fetchNotes</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">[</span>currentUser<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>Tasks tasks<span class="token operator">=</span><span class="token punctuation">{</span>tasks<span class="token punctuation">}</span> tasksLoading<span class="token operator">=</span><span class="token punctuation">{</span>tasksLoading<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Notes notes<span class="token operator">=</span><span class="token punctuation">{</span>notes<span class="token punctuation">}</span> notesLoading<span class="token operator">=</span><span class="token punctuation">{</span>notesLoading<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Since we are no longer merging the old state into the big state object, we no longer have the racing condition. This is a perfectly valid approach for fixing the problem, but unfortunately, it means we have lost the hierarchical nature of the state object (so we can no longer use it as a view model) — remember that when we are lifting the state to the parent component, we would like the structure of the object to reflect the child component hierarchy.</p>
<p>A fundamental difference between the old approach and the new one is the addition of the <code class="language-text">useEffect</code> hook, which is called after the functional component has rendered, making it behave like the <code class="language-text">componentWillReceiveProps</code> function. This approach is interesting because using this method to make API calls (and therefore changing the state) leads to rerendering. Reacting to state changes in the application is generally considered bad practice because it can also lead to complicated dependency chains, making the code hard to follow. Infinite loops are also a common problem in code written by newcomers.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">fetchTasks</span><span class="token punctuation">(</span>currentUser<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Calling the <code class="language-text">fetchTask</code> method like this causes an infinite loop because it sets the <code class="language-text">isLoading</code> field to <code class="language-text">true</code>, which triggers rerendering, which calls the effect again. In some cases, the dependency cycles might be more complicated: a parent component might trigger an effect in a child component, making the problem harder to diagnose. To make matters slightly worse is the fact that React’s strict mode triggers double rendering for debugging purposes (React tries to ensure your state changes are <a href="https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation#:~:text=at%204%3A12-,12,as%20making%20a%20single%20request.">idempotent</a>, and don’t lead to infinite refreshing loops), which can make things extra confusing.</p>
<p>To wrap up, while hooks are a welcome addition to React, the learning curve can be quite steep.</p></section></article></div></main><footer style="background-color:#eee">Blaakjskas</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2021-11-18-hooks/";window.___webpackCompilationHash="579701483d0773630952";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-30f2bf2a1846f97f91ab.js"],"app":["/app-b6ea4da22fe8df02d68e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-4da56516dd4ffcf4ac5d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2943ff216d3bda5ffaf2.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f8d416ec47ce73507d68.js"]};/*]]>*/</script><script src="/polyfill-30f2bf2a1846f97f91ab.js" nomodule=""></script><script src="/app-b6ea4da22fe8df02d68e.js" async=""></script><script src="/framework-d9aa49d9654a57a5d41b.js" async=""></script><script src="/webpack-runtime-8f3d7f193a34cf8f150c.js" async=""></script></body></html>